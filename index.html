<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Net Hours">

<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦…</text></svg>">

<title>Net Hours Calculator</title>

<style>

body { font-family: Arial; padding:10px; margin:0; background:#f9f9f9; }
h2 { text-align:center; }

/* Buttons */
button {
  padding:7px 10px;
  margin:4px 3px;
  font-size:15px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
}

/* Header layout */
.timeRow {
  margin-top:10px;
}

/* Net boxes */
.netBox {
  border:2px solid #ccc;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  background:white;
}

.netBox.closed {
  border-color:red;
  background:#ffe6e6;
}

/* Interval rows */
.intervalRow {
  display:flex;
  flex-wrap:nowrap;   /* prevents wrapping */
  gap:4px;
  margin-top:6px;
  align-items:center;
}

.intervalRow input {
  width:85px;         /* smaller width fixes wrapping */
  font-size:15px;
}

.intervalRow span {
  font-size:14px;
  white-space:nowrap;
}

.totals {
  font-weight:bold;
  margin-top:10px;
}

</style>
</head>

<body>

<h2>Net Hours Calculator</h2>

<div style="text-align:center;">
<button onclick="setSite('Palo')">Palo</button>
<button onclick="setSite('Offsite')">Offsite</button>
<button onclick="setSite('RECR')">RECR</button>
</div>

<!-- Separate header rows -->

<div class="timeRow">
<label>Default Nets Open Time</label>
<input type="time" id="defaultOpen">
</div>

<div class="timeRow">
<label>Current Time</label>
<input type="time" id="currentTime" oninput="updateTotals()">
</div>

<div>
<button onclick="applyDefault()">Apply Default Open Time</button>
<button onclick="render()">Calculate</button>
<div class="totals" id="totalsDisplay"></div>
</div>

<div id="netsContainer"></div>

<script>

/* ---------- SITE SETUP ---------- */

const paloTemplate = [
  {name:"5.0", weight:2},{name:"2.1", weight:2},{name:"5.5", weight:1},
  {name:"5.6", weight:1},{name:"5.7", weight:1},{name:"10.1", weight:2},
  {name:"10.2", weight:1},{name:"10.3", weight:1},{name:"8.5", weight:2},
  {name:"8.4", weight:2},{name:"8.3", weight:2},{name:"1.4", weight:1},
  {name:"2.3", weight:1},{name:"2.4", weight:1}
];

function numberedTemplate(n){
  return Array.from({length:n}, (_,i)=>({name:(i+1).toString(), weight:1}));
}

let nets=[];
setSite("Palo");

function cloneTemplate(template){
  return template.map(n=>({name:n.name, weight:n.weight, intervals:[]}));
}

/* ---------- HELPERS ---------- */

function parseTime(t){
  if(!t) return null;
  return new Date("2020-01-01T"+t);
}

function sessionEnd(open){
  return new Date(open.getTime()+6*3600000);
}

/* ---------- STATUS ---------- */

function netIsOpen(net){
  if(net.intervals.length===0) return false;
  let last=net.intervals[net.intervals.length-1];
  return last.open && !last.close;
}

/* ---------- CALCULATIONS ---------- */

function netTotalHours(net,current){
  let total=0;

  net.intervals.forEach(int=>{
    if(!int.open) return;

    let open=parseTime(int.open);
    let close=int.close ? parseTime(int.close) : current;

    if(close>current) close=current;

    let dur=(close-open)/3600000;
    if(dur>0) total+=dur*net.weight;
  });

  return total;
}

function totalNetsOpen(){
  let total=0;
  nets.forEach(net=>{
    if(netIsOpen(net)) total+=net.weight;
  });
  return total;
}

/* ---------- RENDER ---------- */

function render(){

  let container=document.getElementById("netsContainer");
  container.innerHTML="";

  let defaultVal=document.getElementById("defaultOpen").value;
  if(!defaultVal) return;

  let currentVal=document.getElementById("currentTime").value;
  let current=currentVal ? parseTime(currentVal) : sessionEnd(parseTime(defaultVal));

  nets.forEach(net=>{

    let box=document.createElement("div");
    box.className="netBox";

    if(!netIsOpen(net)) box.classList.add("closed");

    let total=netTotalHours(net,current);

    box.innerHTML=`<b>${net.name} (${net.weight} ${net.weight===1?"net":"nets"}) â€” ${total.toFixed(2)} hrs</b>`;

    net.intervals.forEach((interval,j)=>{

      let row=document.createElement("div");
      row.className="intervalRow";

      row.innerHTML=`
        <span>Open:</span>
        <input type="time" value="${interval.open||""}">
        <span>Close:</span>
        <input type="time" value="${interval.close||""}">
        <button>âœ•</button>
      `;

      let inputs=row.querySelectorAll("input");
      inputs[0].oninput=e=>{ interval.open=e.target.value; updateTotals(); };
      inputs[1].oninput=e=>{ interval.close=e.target.value; updateTotals(); };

      row.querySelector("button").onclick=()=>{
        net.intervals.splice(j,1);
        render();
      };

      box.appendChild(row);
    });

    let addBtn=document.createElement("button");
    addBtn.innerText="Add Interval";
    addBtn.onclick=()=>{
      net.intervals.push({open:"", close:""});
      render();
    };

    box.appendChild(addBtn);
    container.appendChild(box);
  });

  updateTotals();
}

/* ---------- TOTAL DISPLAY ---------- */

function updateTotals(){

  let defaultVal=document.getElementById("defaultOpen").value;
  if(!defaultVal) return;

  let currentVal=document.getElementById("currentTime").value;
  let current=currentVal ? parseTime(currentVal) : sessionEnd(parseTime(defaultVal));

  let accumulated=0;
  let maxPossible=0;

  nets.forEach(net=>{
    accumulated+=netTotalHours(net,current);

    if(netIsOpen(net)){
      let remaining=(sessionEnd(parseTime(defaultVal))-current)/3600000;
      if(remaining>0) maxPossible+=remaining*net.weight;
    }
  });

  maxPossible+=accumulated;

  let totalPossible=nets.reduce((s,n)=>s+n.weight*6,0);
  let threshold=totalPossible*(2/3);

  document.getElementById("totalsDisplay").innerHTML=
    `Accumulated Net Hours: ${accumulated.toFixed(2)}<br>
     Total Nets Open: ${totalNetsOpen()}<br>
     Maximum Possible: ${maxPossible.toFixed(2)}<br>
     Threshold: ${threshold.toFixed(2)}<br>
     Status: ${maxPossible>=threshold?"âœ… Reachable":"âŒ Not Reachable"}`;
}

/* ---------- BUTTONS ---------- */

function applyDefault(){
  let val=document.getElementById("defaultOpen").value;
  if(!val) return;

  nets.forEach(net=>{
    net.intervals=[{open:val, close:""}];
  });

  render();
}

function setSite(site){
  if(site==="Palo") nets=cloneTemplate(paloTemplate);
  if(site==="Offsite") nets=cloneTemplate(numberedTemplate(10));
  if(site==="RECR") nets=cloneTemplate(numberedTemplate(11));
  render();
}

</script>

</body>
</html>
